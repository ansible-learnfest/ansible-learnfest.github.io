<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.69.0" />
    <meta name="description" content="An Ansible Automation Platform 2 learning experience">
<meta name="author" content="GÃ¶tz, Christian">

    <link rel="icon" href="https://ansible-learnfest.github.io/images/favicon.png" type="image/png">

    <title>Using Private Automation Hub :: Ansible LearnFest</title>

    
    <link href="https://ansible-learnfest.github.io/css/nucleus.css?1657652981" rel="stylesheet">
    <link href="https://ansible-learnfest.github.io/css/fontawesome-all.min.css?1657652981" rel="stylesheet">
    <link href="https://ansible-learnfest.github.io/css/hybrid.css?1657652981" rel="stylesheet">
    <link href="https://ansible-learnfest.github.io/css/featherlight.min.css?1657652981" rel="stylesheet">
    <link href="https://ansible-learnfest.github.io/css/perfect-scrollbar.min.css?1657652981" rel="stylesheet">
    <link href="https://ansible-learnfest.github.io/css/auto-complete.css?1657652981" rel="stylesheet">
    <link href="https://ansible-learnfest.github.io/css/atom-one-dark-reasonable.css?1657652981" rel="stylesheet">
    <link href="https://ansible-learnfest.github.io/css/theme.css?1657652981" rel="stylesheet">
    <link href="https://ansible-learnfest.github.io/css/tabs.css?1657652981" rel="stylesheet">
    <link href="https://ansible-learnfest.github.io/css/hugo-theme.css?1657652981" rel="stylesheet">
    
    <link href="https://ansible-learnfest.github.io/css/theme-red.css?1657652981" rel="stylesheet">
    
    

    <script src="https://ansible-learnfest.github.io/js/jquery-3.3.1.min.js?1657652981"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/3-track-1/4-use-pah/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://ansible-learnfest.github.io/">
    <img src="https://ansible-learnfest.github.io/images/aap-learnfest-logo.png">
  </a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="https://ansible-learnfest.github.io/js/lunr.min.js?1657652981"></script>
<script type="text/javascript" src="https://ansible-learnfest.github.io/js/auto-complete.js?1657652981"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/ansible-learnfest.github.io\/";
    
</script>
<script type="text/javascript" src="https://ansible-learnfest.github.io/js/search.js?1657652981"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='https://ansible-learnfest.github.io/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/1-intro/" title="Introduction" class="dd-item
        
        
        
        ">
      <a href="https://ansible-learnfest.github.io/1-intro/">
          Introduction
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/2-getting-started/" title="Prepare Base Environment" class="dd-item
        
        
        
        ">
      <a href="https://ansible-learnfest.github.io/2-getting-started/">
          Prepare Base Environment
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/3-track-1/" title="Track 1: AAP Administrator" class="dd-item
        parent
        
        
        ">
      <a href="https://ansible-learnfest.github.io/3-track-1/">
          Track 1: AAP Administrator
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/3-track-1/1-automation-controller/" title="Install Automation Controller" class="dd-item
        
        
        
        ">
      <a href="https://ansible-learnfest.github.io/3-track-1/1-automation-controller/">
          Install Automation Controller
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-track-1/2-config-controller/" title="Configure Automation Controller" class="dd-item
        
        
        
        ">
      <a href="https://ansible-learnfest.github.io/3-track-1/2-config-controller/">
          Configure Automation Controller
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-track-1/3-install-pah/" title="Install Private Automation Hub" class="dd-item
        
        
        
        ">
      <a href="https://ansible-learnfest.github.io/3-track-1/3-install-pah/">
          Install Private Automation Hub
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-track-1/4-use-pah/" title="Using Private Automation Hub" class="dd-item
        
        active
        
        ">
      <a href="https://ansible-learnfest.github.io/3-track-1/4-use-pah/">
          Using Private Automation Hub
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-track-1/5-automation-mesh/" title="Extend Automation Mesh" class="dd-item
        
        
        
        ">
      <a href="https://ansible-learnfest.github.io/3-track-1/5-automation-mesh/">
          Extend Automation Mesh
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-track-1/6-aap2-fullstack/" title="AAP 2 Full Stack Installation" class="dd-item
        
        
        
        ">
      <a href="https://ansible-learnfest.github.io/3-track-1/6-aap2-fullstack/">
          AAP 2 Full Stack Installation
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-track-1/7-bonus-using-catalog/" title="Bonus Track: Automation Catalog" class="dd-item
        
        
        
        ">
      <a href="https://ansible-learnfest.github.io/3-track-1/7-bonus-using-catalog/">
          Bonus Track: Automation Catalog
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/4-track-2/" title="Track 2: Automation Content Developer" class="dd-item
        
        
        
        ">
      <a href="https://ansible-learnfest.github.io/4-track-2/">
          Track 2: Automation Content Developer
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/4-track-2/1-vscode/" title="The VSCode extension" class="dd-item
        
        
        
        ">
      <a href="https://ansible-learnfest.github.io/4-track-2/1-vscode/">
          The VSCode extension
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/4-track-2/2-build-ee/" title="Build an execution environment" class="dd-item
        
        
        
        ">
      <a href="https://ansible-learnfest.github.io/4-track-2/2-build-ee/">
          Build an execution environment
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/4-track-2/3-transfer-ee/" title="Transfer Execution Environment" class="dd-item
        
        
        
        ">
      <a href="https://ansible-learnfest.github.io/4-track-2/3-transfer-ee/">
          Transfer Execution Environment
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/4-track-2/4-use-ee/" title="Using Private Automation Hub" class="dd-item
        
        
        
        ">
      <a href="https://ansible-learnfest.github.io/4-track-2/4-use-ee/">
          Using Private Automation Hub
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://devsecops-workshop.github.io/"><i class='fas fa-home'></i> Homepage</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='https://ansible-learnfest.github.io/'></a> > <a href='https://ansible-learnfest.github.io/3-track-1/'>Track 1: AAP Administrator</a> > Using Private Automation Hub
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#task-4-using-private-automation-hub">Task 4: Using Private Automation Hub</a>
      <ul>
        <li><a href="#integrate-private-automation-hub-into-automation-controller">Integrate <strong>Private Automation Hub</strong> into Automation Controller</a></li>
        <li><a href="#add-content-to-your-private-automation-hub">Add content to your <strong>Private Automation Hub</strong></a></li>
        <li><a href="#test-private-automation-hub-integration">Test <strong>Private Automation Hub</strong> Integration</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Using Private Automation Hub
            </h1>
          

        



	<h2 id="task-4-using-private-automation-hub">Task 4: Using Private Automation Hub</h2>
<p><strong>Prerequisites</strong></p>
<ul>
<li>Automation Controller is running &amp; accessible</li>
<li>Private Automation Hub is running &amp; accessible</li>
</ul>
<p><strong>Tasks</strong></p>
<ul>
<li>Configure Automation Controller to access your Private Automation Hub</li>
<li>Add collections from Red Hat Automation Hub, Galaxy and custom ones created by you.</li>
<li>Add Excution Environment images</li>
</ul>

<div class="notices tip" ><p>Important: You only have to do this because we didn&rsquo;t have installer install Controller and PAH in one go. Then the integration would have been configured for you already. For the sake of understanding we decided to let you do this manually. Note: The Execution Environemnt images coming with the bundle installer have been pushed to the PAH registry already.</p>
</div>

<p>Let&rsquo;s start, as the docs for this are distributed over some places we&rsquo;ll give some more instructions.</p>
<h3 id="integrate-private-automation-hub-into-automation-controller">Integrate <strong>Private Automation Hub</strong> into Automation Controller</h3>
<ul>
<li>In you PAH go to <strong>Collections-&gt;API token management</strong>, hit <strong>Load Token</strong> and copy the token. Put it somewhere, the token will change every time you have to get it this way again!</li>
<li>In Controller, go to <strong>Resources-&gt;Credentials</strong> and <strong>Add</strong> three new credentials:
<ul>
<li>Name them <strong>PAH community</strong>, <strong>PAH certified</strong> and <strong>Pah published</strong></li>
<li>All belong to the <strong>Organisation</strong> <code>default</code></li>
<li>Credential Type is <strong>Ansible Galaxy/Automation Hub API Token</strong></li>
<li>Look up the <strong>Galaxy Server URL</strong> for each in PAH: In <strong>Collections-&gt;Repository Management</strong> lookup the <strong>Repo URL</strong> for <strong>community</strong>, <strong>published</strong> and <strong>rh-certified</strong> and put them in respectively.</li>
<li>You have created the API token already, paste in into the credentials</li>
<li>As your PAH is using a self-signed certificate, disable the certificate verification:
<ul>
<li>Go to <strong>Settings-&gt;Jobs Settings</strong>, click <strong>Edit</strong> and set <code>Ignore Ansible Galaxy SSL Certificate Verification</code> to <strong>On</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>The last thing you have to setup is to configure the Organization (<code>default</code> here) to use the PAH credentials and the order it searches them:</p>
<ul>
<li>Go to <strong>Access-&gt;Organizations</strong>, choose the <code>default</code> Organization and click <strong>Edit</strong></li>
<li>In <code>Galaxy Credentials</code> remove <code>Ansible Galaxy</code> and add our three PAH credentials</li>
<li>Note how you could change the order here</li>
<li>Click <strong>Save</strong></li>
</ul>
<h3 id="add-content-to-your-private-automation-hub">Add content to your <strong>Private Automation Hub</strong></h3>
<p>Most of this is well documented <a href="https://access.redhat.com/documentation/en-us/red_hat_ansible_automation_platform/2.1/html-single/managing_red_hat_certified_and_ansible_galaxy_collections_in_automation_hub/index">here</a></p>
<h4 id="sync-collections-from-red-hat-automation-hub">Sync collections from Red Hat Automation Hub</h4>
<ul>
<li>Go to <code>console.redhat.com</code> and open <strong>Ansible Automation Platform-&gt;Automation Hub-&gt;Collections</strong>. Here you <strong>could enable/disable the sync of certain collections but there is a bug as of now!</strong> We&rsquo;ll give you a working URL to sync all content as a workaround.</li>
<li>What you need to do is to get the autentication token and configure it in your PAH:
<ul>
<li>In Red Hat Automation Hub Go to <strong>Connect to Hub</strong> and copy the <strong>Offline Token</strong></li>
<li>In PAH go to <strong>Collections-&gt;Repository management-&gt;Remote</strong></li>
<li>Edit the <code>rh-certified</code> remote:
<ul>
<li><strong>URL</strong> `<a href="https://console.redhat.com/api/automation-hub/content/published/">https://console.redhat.com/api/automation-hub/content/published/</a></li>
<li><strong>Token</strong> the token you copied from RH AH</li>
<li>Click <strong>Save</strong> and then hit <strong>Sync</strong>. This will sync all collections from Red Hat Automation Hub to your Private Automation Hub.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="sync-selected-comunity-collections-from-ansible-galaxy">Sync selected comunity collections from Ansible Galaxy</h4>
<ul>
<li>Galaxy is configured as the remote <code>community</code> out of the box</li>
<li>To sync collections:
<ul>
<li>Create a regular requirements.yml file pointing to the collection you want, we&rsquo;ll use the one from the docs:</li>
</ul>
</li>
</ul>
<pre><code>collections:
  # Install a collection from Ansible Galaxy.
  - name: geerlingguy.php_roles
    version: 0.9.3
    source: https://galaxy.ansible.com
</code></pre><ul>
<li>Go to Repo Management, click the <strong>Remote</strong> tab again</li>
<li>Edit the <code>community</code> remote</li>
<li>In <strong>YAML requirements</strong> upload the  <code>requirements.yml</code> file from your local machine.</li>
<li>Click <strong>Save</strong></li>
<li>In the <strong>Remote</strong> overview tab click <strong>Sync</strong> for the <code>community</code> remote</li>
</ul>
<p>Verify the sync of the collections in <strong>Collections-&gt;Collections</strong>, switch the repositories with the dropdown at the top. There should be a lot of content in the <code>Red Hat Certified</code> repo and one collection in the <code>Community</code> repo.</p>
<h4 id="push-images-to-pah-registry">Push Images to PAH Registry</h4>
<ul>
<li>As test push a local image to PAH</li>
<li>Example: <code>podman push --tls-verify=false quay.io/redhat_emp1/ee-ansible-ssa &lt;PAH-HOST&gt;/ee-ansible-ssa</code></li>
<li>Check in PAH under <strong>Execution Environments</strong></li>
</ul>
<h3 id="test-private-automation-hub-integration">Test <strong>Private Automation Hub</strong> Integration</h3>
<p>Now check that your Automation Controller can actually use the content from your PAH:</p>
<ul>
<li>Create a new <strong>Project</strong> pointing here: <code>https://github.com/ansible-learnfest/playbooks-example.git</code>
<ul>
<li>Have a look at the content, esp the <code>collections/requirements.yml</code> file</li>
</ul>
</li>
<li>Create a new <strong>Template</strong>:
<ul>
<li><strong>Name</strong>: up to you</li>
<li><strong>Inventory</strong>: The one you set up with the Playbook before, it should contain one of your AWS instances</li>
<li><strong>Project</strong>: The one you just created</li>
<li><strong>Execution Environment</strong>: <code>Ansible Engine 2.9 execution environment</code></li>
<li><strong>Playbook</strong>: <code>install-php.yml</code></li>
<li>Check <strong>Privilege Escalation</strong></li>
</ul>
</li>
<li>Launch the <strong>Template</strong>, if all was configured correctly it should install PHP modules on the managed node.</li>
</ul>
<p>So recap what happened:</p>
<ul>
<li>You created a <strong>Template</strong> that runs a Playbook that has a requirement on a certain Collection which is not part of the Execution Environments included in Controller.</li>
<li>Your <strong>Organization</strong> (<code>default</code>) is configured in a way it can only download Collections from your Private Automation Hub</li>
<li>The Collection did exist on your PAH</li>
<li><strong>Important</strong>: As this collection is not part of the Execution Environment the Playbook run in, how did it work? In this case is it was dynamically &ldquo;added&rdquo; to the Execution Environment at runtime.</li>
</ul>
<p><strong>Goal</strong></p>
<p><strong>Tips</strong></p>





<footer class=" footline" >
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="https://ansible-learnfest.github.io/3-track-1/3-install-pah/" title="Install Private Automation Hub"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="https://ansible-learnfest.github.io/3-track-1/5-automation-mesh/" title="Extend Automation Mesh" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://ansible-learnfest.github.io/js/clipboard.min.js?1657652981"></script>
    <script src="https://ansible-learnfest.github.io/js/perfect-scrollbar.min.js?1657652981"></script>
    <script src="https://ansible-learnfest.github.io/js/perfect-scrollbar.jquery.min.js?1657652981"></script>
    <script src="https://ansible-learnfest.github.io/js/jquery.sticky.js?1657652981"></script>
    <script src="https://ansible-learnfest.github.io/js/featherlight.min.js?1657652981"></script>
    <script src="https://ansible-learnfest.github.io/js/highlight.pack.js?1657652981"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://ansible-learnfest.github.io/js/modernizr.custom-3.6.0.js?1657652981"></script>
    <script src="https://ansible-learnfest.github.io/js/learn.js?1657652981"></script>
    <script src="https://ansible-learnfest.github.io/js/hugo-learn.js?1657652981"></script>
    
        
            <script src="https://ansible-learnfest.github.io/mermaid/mermaid.js?1657652981"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>
