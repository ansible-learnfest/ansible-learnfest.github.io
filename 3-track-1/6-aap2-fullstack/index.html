<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.69.0" />
    <meta name="description" content="An Ansible Automation Platform 2 learning experience">
<meta name="author" content="GÃ¶tz, Christian">

    <link rel="icon" href="https://ansible-learnfest.github.io/images/favicon.png" type="image/png">

    <title>AAP 2 Full Stack Installation :: Ansible LearnFest</title>

    
    <link href="https://ansible-learnfest.github.io/css/nucleus.css?1657702122" rel="stylesheet">
    <link href="https://ansible-learnfest.github.io/css/fontawesome-all.min.css?1657702122" rel="stylesheet">
    <link href="https://ansible-learnfest.github.io/css/hybrid.css?1657702122" rel="stylesheet">
    <link href="https://ansible-learnfest.github.io/css/featherlight.min.css?1657702122" rel="stylesheet">
    <link href="https://ansible-learnfest.github.io/css/perfect-scrollbar.min.css?1657702122" rel="stylesheet">
    <link href="https://ansible-learnfest.github.io/css/auto-complete.css?1657702122" rel="stylesheet">
    <link href="https://ansible-learnfest.github.io/css/atom-one-dark-reasonable.css?1657702122" rel="stylesheet">
    <link href="https://ansible-learnfest.github.io/css/theme.css?1657702122" rel="stylesheet">
    <link href="https://ansible-learnfest.github.io/css/tabs.css?1657702122" rel="stylesheet">
    <link href="https://ansible-learnfest.github.io/css/hugo-theme.css?1657702122" rel="stylesheet">
    
    <link href="https://ansible-learnfest.github.io/css/theme-red.css?1657702122" rel="stylesheet">
    
    

    <script src="https://ansible-learnfest.github.io/js/jquery-3.3.1.min.js?1657702122"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/3-track-1/6-aap2-fullstack/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://ansible-learnfest.github.io/">
    <img src="https://ansible-learnfest.github.io/images/aap-learnfest-logo.png">
  </a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="https://ansible-learnfest.github.io/js/lunr.min.js?1657702122"></script>
<script type="text/javascript" src="https://ansible-learnfest.github.io/js/auto-complete.js?1657702122"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/ansible-learnfest.github.io\/";
    
</script>
<script type="text/javascript" src="https://ansible-learnfest.github.io/js/search.js?1657702122"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='https://ansible-learnfest.github.io/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/1-intro/" title="Introduction" class="dd-item
        
        
        
        ">
      <a href="https://ansible-learnfest.github.io/1-intro/">
          Introduction
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/2-getting-started/" title="Prepare Base Environment" class="dd-item
        
        
        
        ">
      <a href="https://ansible-learnfest.github.io/2-getting-started/">
          Prepare Base Environment
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/3-track-1/" title="Track 1: AAP Administrator" class="dd-item
        parent
        
        
        ">
      <a href="https://ansible-learnfest.github.io/3-track-1/">
          Track 1: AAP Administrator
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/3-track-1/1-automation-controller/" title="Install Automation Controller" class="dd-item
        
        
        
        ">
      <a href="https://ansible-learnfest.github.io/3-track-1/1-automation-controller/">
          Install Automation Controller
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-track-1/2-config-controller/" title="Configure Automation Controller" class="dd-item
        
        
        
        ">
      <a href="https://ansible-learnfest.github.io/3-track-1/2-config-controller/">
          Configure Automation Controller
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-track-1/3-install-pah/" title="Install Private Automation Hub" class="dd-item
        
        
        
        ">
      <a href="https://ansible-learnfest.github.io/3-track-1/3-install-pah/">
          Install Private Automation Hub
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-track-1/4-use-pah/" title="Using Private Automation Hub" class="dd-item
        
        
        
        ">
      <a href="https://ansible-learnfest.github.io/3-track-1/4-use-pah/">
          Using Private Automation Hub
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-track-1/5-automation-mesh/" title="Extend Automation Mesh" class="dd-item
        
        
        
        ">
      <a href="https://ansible-learnfest.github.io/3-track-1/5-automation-mesh/">
          Extend Automation Mesh
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-track-1/6-aap2-fullstack/" title="AAP 2 Full Stack Installation" class="dd-item
        
        active
        
        ">
      <a href="https://ansible-learnfest.github.io/3-track-1/6-aap2-fullstack/">
          AAP 2 Full Stack Installation
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-track-1/7-bonus-using-catalog/" title="Bonus Track: Automation Catalog" class="dd-item
        
        
        
        ">
      <a href="https://ansible-learnfest.github.io/3-track-1/7-bonus-using-catalog/">
          Bonus Track: Automation Catalog
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/4-track-2/" title="Track 2: Automation Content Developer" class="dd-item
        
        
        
        ">
      <a href="https://ansible-learnfest.github.io/4-track-2/">
          Track 2: Automation Content Developer
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/4-track-2/1-vscode/" title="The VSCode extension" class="dd-item
        
        
        
        ">
      <a href="https://ansible-learnfest.github.io/4-track-2/1-vscode/">
          The VSCode extension
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/4-track-2/2-build-ee/" title="Build an execution environment" class="dd-item
        
        
        
        ">
      <a href="https://ansible-learnfest.github.io/4-track-2/2-build-ee/">
          Build an execution environment
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/4-track-2/3-transfer-ee/" title="Transfer Execution Environment" class="dd-item
        
        
        
        ">
      <a href="https://ansible-learnfest.github.io/4-track-2/3-transfer-ee/">
          Transfer Execution Environment
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/4-track-2/4-use-ee/" title="Using Private Automation Hub" class="dd-item
        
        
        
        ">
      <a href="https://ansible-learnfest.github.io/4-track-2/4-use-ee/">
          Using Private Automation Hub
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://devsecops-workshop.github.io/"><i class='fas fa-home'></i> Homepage</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='https://ansible-learnfest.github.io/'></a> > <a href='https://ansible-learnfest.github.io/3-track-1/'>Track 1: AAP Administrator</a> > AAP 2 Full Stack Installation
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#task-6-start-over-with-full-stack-installation">Task 6: Start over with Full-Stack Installation</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              AAP 2 Full Stack Installation
            </h1>
          

        



	<h2 id="task-6-start-over-with-full-stack-installation">Task 6: Start over with Full-Stack Installation</h2>
<p>Until now you installed and configured an AAP 2.2 environment component by component. In real life you would have the installer deploy all components in one go, so you would get an environment with integrated components consisting of:</p>
<ul>
<li>Automation Controller</li>
<li>Private Automation Hub</li>
<li>Automation Services Catalog (Tech Preview)</li>
<li>Red Hat SSO for central authentication (required for Catalog, optional for other components)</li>
</ul>
<p>So in this section you&rsquo;ll build the whole thing.</p>
<p><strong>Prerequisites</strong></p>
<ul>
<li>Delete your AWS environment</li>
</ul>
<p><code>ansible-navigator run cloud-infra.yml -m stdout -e remove=true</code></p>
<ul>
<li>and start over with new instances:</li>
</ul>
<p><code>ansible-navigator run cloud-infra.yml -m stdout</code></p>
<ul>
<li>Open the instances security groups so we don&rsquo;t have to tweak filter rules for now. <strong>Disclaimer: Only for lab use, not in real life!</strong></li>
<li>In the AWS console for each of your instances
<ul>
<li>Go to <strong>Instance Details -&gt; Security -&gt; Click &ldquo;Security Group&rdquo;</strong></li>
<li>Add an inbound rule <strong>All traffic</strong> to <strong>0.0.0.0/0</strong></li>
<li>Save</li>
</ul>
</li>
</ul>
<p><strong>Tasks</strong></p>
<ul>
<li>SSH to instance 1, <strong>as root</strong> create a new SSH key pair (<code>ssh-keygen</code>)and add the new public key to the <code>authorized_keys</code> file of <strong>ec2-user</strong> on the other three instances.
<ul>
<li>The AAP installer on instance 1 needs to SSH into the other instances!</li>
</ul>
</li>
<li>Download/unpack the <strong>Ansible Automation Platform 2.2.0 Setup Bundle</strong> on instance 1 again.</li>
<li>Register the SSO host (instance 4) and enable Java repo (yeah, RH SSO is Java-based!)
<ul>
<li><code>subscription-manager register</code></li>
<li><code>subscription-manager repos --enable=jb-eap-7.3-for-rhel-8-x86_64-rpms</code></li>
</ul>
</li>
<li>Create an inventory file to configure Installer:
<ul>
<li>Use the template below, fill in missing values</li>
</ul>
</li>
<li>The inventory should:
<ul>
<li>install Controller on instance 1</li>
<li>install the other three AAP components from instance 1 on the other instances: <strong>instance 2 - PAH</strong>, <strong>instance 3 - Catalog</strong>, <strong>instance 4 - SSO</strong></li>
</ul>
</li>
</ul>

<div class="notices tip" ><p>Ansible basics: Disable host key checking, either by running <code>export ANSIBLE_HOST_KEY_CHECKING=False; ./setup.sh</code> or by putting</p>
<pre><code>[defaults]
host_key_checking = False
</code></pre><p>into ./ansible.cfg</p>
</div>

<ul>
<li>Run the installer</li>
<li>Get a coffee. Or two.</li>
</ul>
<p>After the installation has finished, <strong>Private Automation Hub</strong> and <strong>Automation Services Catalog</strong> are configured for SSO. So to be able to login to the UIs, you have to configure a user with the proper roles in <strong>RH SSO</strong>.</p>
<ul>
<li>Create an admin user for PAH and catalog in the RH SSO Admin UI (<code>https://&lt;instance&gt;:8443</code>):
<ul>
<li><strong>Manage</strong> -&gt; <strong>Users</strong> -&gt; <strong>View all users</strong></li>
<li>Create user <strong>aapadmin</strong></li>
<li><strong>Save</strong></li>
<li>Set a password in <strong>Credentials</strong></li>
<li>In <strong>Role Mappings</strong> for this user: In <strong>Client Roles</strong> choose <code>automation-catalog</code>
<ul>
<li>Add role <code>catalog-admin</code></li>
</ul>
</li>
<li>For <strong>Client Role</strong> <code>automation-hub</code>
<ul>
<li>Add role <code>hubadmin</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Now you have a user with admin permissions for PAH and Catalog.</p>
<p><strong>Goal</strong></p>
<ul>
<li>Access to the web UIs on all four instances:
<ul>
<li>Automation Controller (user <code>admin</code>, password as set in inventory)</li>
<li>Private Automation Hub (SSO user)</li>
<li>Automation Services Catalog (sso user)</li>
<li>RH SSO Admin UI (Port 8443, user <code>admin</code>, password as set in inventory)</li>
</ul>
</li>
</ul>
<p><strong>Tips</strong></p>
<p>Example inventory file:</p>
<pre><code>[automationcontroller]
&lt;instance-1&gt; ansible_connection=local

[automationcontroller:vars]
peers=execution_nodes

[execution_nodes]

[automationhub]
&lt;instance-2&gt; ansible_user=ec2-user ansible_become=true

[automationcatalog]
&lt;instance-3&gt; ansible_user=ec2-user ansible_become=true

[database]

[sso]
&lt;instance-4&gt; ansible_user=ec2-user ansible_become=true

[all:vars]
admin_password='&lt;password&gt;'
pg_host=''
pg_port=5432
pg_database='awx'
pg_username='awx'
pg_password='&lt;password&gt;'
pg_sslmode='prefer'  # set to 'verify-full' for client-side enforced SSL

registry_url='registry.redhat.io'
registry_username='&lt;registry user&gt;'
registry_password='&lt;registry token or password'

receptor_listener_port=27199

automationhub_admin_password='&lt;password&gt;'
automationhub_pg_host='&lt;instance-1&gt;'
automationhub_pg_port=5432
automationhub_pg_database='automationhub'
automationhub_pg_username='automationhub'
automationhub_pg_password='&lt;password&gt;'
automationhub_pg_sslmode='prefer'

automationcatalog_pg_host='&lt;instance-1&gt;'
automationcatalog_pg_port=5432
automationcatalog_pg_database='automationservicescatalog'
automationcatalog_pg_username='automationservicescatalog'
automationcatalog_pg_password='&lt;password&gt;'
automationcatalog_controller_verify_ssl=False

sso_keystore_password='&lt;password&gt;'
sso_console_admin_password='&lt;password&gt;'
</code></pre>




<footer class=" footline" >
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="https://ansible-learnfest.github.io/3-track-1/5-automation-mesh/" title="Extend Automation Mesh"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="https://ansible-learnfest.github.io/3-track-1/7-bonus-using-catalog/" title="Bonus Track: Automation Catalog" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://ansible-learnfest.github.io/js/clipboard.min.js?1657702122"></script>
    <script src="https://ansible-learnfest.github.io/js/perfect-scrollbar.min.js?1657702122"></script>
    <script src="https://ansible-learnfest.github.io/js/perfect-scrollbar.jquery.min.js?1657702122"></script>
    <script src="https://ansible-learnfest.github.io/js/jquery.sticky.js?1657702122"></script>
    <script src="https://ansible-learnfest.github.io/js/featherlight.min.js?1657702122"></script>
    <script src="https://ansible-learnfest.github.io/js/highlight.pack.js?1657702122"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://ansible-learnfest.github.io/js/modernizr.custom-3.6.0.js?1657702122"></script>
    <script src="https://ansible-learnfest.github.io/js/learn.js?1657702122"></script>
    <script src="https://ansible-learnfest.github.io/js/hugo-learn.js?1657702122"></script>
    
        
            <script src="https://ansible-learnfest.github.io/mermaid/mermaid.js?1657702122"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>
